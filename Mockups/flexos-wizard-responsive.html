<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>FlexOS AI Builder</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-primary: #0F1419;
            --bg-secondary: #1A1F26;
            --bg-tertiary: #242B33;
            --bg-quaternary: #2D3440;
            
            --text-primary: #F7F9FA;
            --text-secondary: #D1D9E0;
            --text-tertiary: #8B949E;
            --text-muted: #6E7681;
            
            --border-primary: #30363D;
            --border-secondary: #3A4046;
            
            --primary-500: #16C181;
            --primary-400: #34D399;
            --primary-600: #10A574;
            
            --purple-500: #8B5CF6;
            --purple-400: #A855F7;
            
            --blue-500: #3B82F6;
            --yellow-500: #EAB308;
            --pink-500: #EC4899;
            
            --safe-area-top: env(safe-area-inset-top);
            --safe-area-bottom: env(safe-area-inset-bottom);
            
            /* Breakpoints */
            --mobile-max: 768px;
            --tablet-max: 1024px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Main Container */
        .wizard-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 100vh;
            height: 100dvh;
            position: relative;
            transition: grid-template-columns 0.3s ease;
        }

        /* Progress Bar */
        .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--bg-tertiary);
            z-index: 1000;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-500), var(--primary-400));
            width: 0%;
            transition: width 0.5s ease-out;
        }

        /* Chat Panel */
        .chat-panel {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-primary);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Header */
        .chat-header {
            padding: 2rem;
            border-bottom: 1px solid var(--border-primary);
            background: var(--bg-tertiary);
            transition: padding 0.3s ease;
        }

        .wizard-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: font-size 0.3s ease;
        }

        .wizard-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Tab Navigation (Mobile Only) */
        .tab-nav {
            display: none;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
            position: relative;
        }

        .tab-button {
            flex: 1;
            padding: 1rem;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            position: relative;
            cursor: pointer;
        }

        .tab-button.active {
            color: var(--text-primary);
        }

        .tab-button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-500);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .tab-button.active::after {
            transform: scaleX(1);
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* Messages */
        .message {
            display: flex;
            gap: 1rem;
            animation: messageSlide 0.4s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
            transition: width 0.3s ease, height 0.3s ease;
        }

        .ai-avatar {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-400));
            color: white;
        }

        .user-avatar {
            background: var(--bg-quaternary);
            color: var(--text-secondary);
        }

        .message-content {
            background: var(--bg-tertiary);
            padding: 1rem 1.25rem;
            border-radius: 16px;
            max-width: 80%;
            font-size: 0.95rem;
            line-height: 1.5;
            transition: all 0.3s ease;
        }

        .message.user .message-content {
            background: rgba(22, 193, 129, 0.1);
            border: 1px solid rgba(22, 193, 129, 0.3);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            padding: 1rem 1.25rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-tertiary);
            border-radius: 50%;
            animation: typing 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; transform: scale(1); }
            30% { opacity: 1; transform: scale(1.2); }
        }

        /* Input Area */
        .chat-input-area {
            padding: 2rem;
            border-top: 1px solid var(--border-primary);
            background: var(--bg-secondary);
            transition: padding 0.3s ease;
        }

        /* Reply Context */
        .reply-context {
            background: var(--bg-quaternary);
            border-left: 3px solid var(--purple-500);
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border-radius: 4px;
            font-size: 0.875rem;
            color: var(--text-secondary);
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .reply-context-content {
            flex: 1;
        }

        .close-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 1rem;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: var(--bg-quaternary);
            color: var(--text-secondary);
        }

        /* Input Container */
        .input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 24px;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.2s;
            resize: none;
            outline: none;
        }

        .chat-input:focus {
            border-color: var(--primary-500);
            background: var(--bg-quaternary);
        }

        .send-btn {
            background: var(--primary-500);
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .send-btn:hover {
            background: var(--primary-600);
            transform: scale(1.05);
        }

        .send-btn:active {
            transform: scale(0.95);
        }

        .send-btn:disabled {
            background: var(--bg-quaternary);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        /* Process Panel */
        .process-panel {
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .process-header {
            padding: 2rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
        }

        .process-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .process-subtitle {
            color: var(--text-tertiary);
            font-size: 0.875rem;
        }

        .process-content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            -webkit-overflow-scrolling: touch;
        }

        /* Process Items */
        .process-section {
            margin-bottom: 2rem;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .process-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .process-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s;
            cursor: pointer;
            opacity: 0;
            animation: processItemSlide 0.4s ease-out forwards;
        }

        @keyframes processItemSlide {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .process-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(-2px);
        }

        .process-item.active {
            border-color: var(--primary-500);
            background: rgba(22, 193, 129, 0.05);
        }

        .process-item.selected {
            border-color: var(--purple-500);
            background: rgba(139, 92, 246, 0.1);
        }

        .process-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .process-text {
            flex: 1;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .process-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .status-complete {
            background: var(--primary-500);
            color: white;
        }

        .status-processing {
            background: var(--yellow-500);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(0.9); }
        }

        /* Color Palette */
        .color-palette {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .color-swatch:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .color-swatch.selected {
            border-color: var(--primary-500);
            transform: scale(1.1);
            box-shadow: 0 0 0 3px rgba(22, 193, 129, 0.3);
        }

        /* Page Grid */
        .page-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .page-item {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-primary);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            opacity: 0;
            animation: pageItemPop 0.4s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        @keyframes pageItemPop {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .page-item:hover {
            border-color: var(--primary-500);
            transform: translateY(-2px);
            background: rgba(22, 193, 129, 0.05);
        }

        .page-item.selected {
            border-color: var(--primary-500);
            background: rgba(22, 193, 129, 0.1);
        }

        .page-item.selected::after {
            content: '✓';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 24px;
            height: 24px;
            background: var(--primary-500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
            font-weight: 700;
            animation: checkPop 0.3s ease-out;
        }

        @keyframes checkPop {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .page-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .page-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Feature List */
        .feature-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-primary);
            border-radius: 8px;
            font-size: 0.875rem;
            opacity: 0;
            animation: featureSlide 0.3s ease-out forwards;
            cursor: pointer;
            transition: all 0.2s;
        }

        .feature-item:hover {
            background: var(--bg-quaternary);
            border-color: rgba(22, 193, 129, 0.3);
        }

        .feature-item.selected {
            border-color: var(--purple-500);
            background: rgba(139, 92, 246, 0.1);
        }

        @keyframes featureSlide {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .feature-check {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-500);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 20px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-primary);
            font-weight: 500;
        }

        .quick-action:hover {
            background: rgba(22, 193, 129, 0.1);
            border-color: var(--primary-500);
            color: var(--primary-500);
            transform: translateY(-1px);
        }

        /* Loader */
        .loader {
            display: inline-flex;
            gap: 0.25rem;
        }

        .loader-dot {
            width: 4px;
            height: 4px;
            background: var(--primary-500);
            border-radius: 50%;
            animation: loaderBounce 1.4s ease-in-out infinite;
        }

        .loader-dot:nth-child(2) { animation-delay: 0.2s; }
        .loader-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes loaderBounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .wizard-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr auto;
            }

            .chat-panel {
                border-right: none;
            }

            .chat-header {
                padding: calc(var(--safe-area-top) + 1rem) 1rem 1rem;
            }

            .wizard-title {
                font-size: 1.125rem;
            }

            .tab-nav {
                display: flex;
                grid-row: 2;
            }

            .chat-messages {
                padding: 1rem;
                padding-bottom: 100px;
            }

            .message-avatar {
                width: 28px;
                height: 28px;
            }

            .message-content {
                font-size: 0.9375rem;
            }

            .chat-input-area {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                padding: 0.75rem;
                padding-bottom: calc(var(--safe-area-bottom) + 0.75rem);
                z-index: 100;
            }

            .process-panel {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                transform: translateX(100%);
                z-index: 90;
            }

            .process-panel.active {
                display: flex;
                transform: translateX(0);
            }

            .process-header {
                padding: calc(var(--safe-area-top) + 1rem) 1rem 1rem;
            }

            .process-content {
                padding: 1rem;
                padding-bottom: 100px;
            }

            .page-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .page-item {
                padding: 0.875rem;
            }

            .page-icon {
                font-size: 1.5rem;
            }

            .page-name {
                font-size: 0.75rem;
            }

            /* Mobile-specific input styles */
            .input-container {
                gap: 0.5rem;
            }

            .chat-input {
                padding: 0.75rem 1.25rem;
                font-size: 0.9375rem;
            }

            .send-btn {
                width: 40px;
                height: 40px;
            }
        }

        /* Tablet Adjustments */
        @media (min-width: 769px) and (max-width: 1024px) {
            .wizard-container {
                grid-template-columns: 1.2fr 1fr;
            }

            .chat-header,
            .process-header {
                padding: 1.5rem;
            }

            .chat-messages,
            .process-content {
                padding: 1.5rem;
            }
        }

        /* High DPI Screens */
        @media (-webkit-min-device-pixel-ratio: 2) {
            .progress-bar {
                height: 2px;
            }
        }

        /* iOS Safe Areas */
        @supports (-webkit-touch-callout: none) {
            .wizard-container {
                height: -webkit-fill-available;
            }
        }

        /* Smooth Transitions for viewport changes */
        @media (prefers-reduced-motion: no-preference) {
            * {
                transition-property: none;
            }

            .wizard-container,
            .chat-header,
            .process-header,
            .chat-messages,
            .process-content,
            .chat-input-area {
                transition-property: padding, transform, grid-template-columns;
                transition-duration: 0.3s;
                transition-timing-function: ease-out;
            }
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <!-- Chat Panel -->
        <div class="chat-panel">
            <div class="chat-header">
                <h1 class="wizard-title">
                    <span style="font-size: 1.5rem;">🧙</span>
                    FlexOS Builder
                </h1>
                <p class="wizard-subtitle" id="wizardSubtitle">Let's build something amazing</p>
            </div>

            <!-- Tab Navigation (Mobile) -->
            <div class="tab-nav">
                <button class="tab-button active" onclick="switchTab('chat')">
                    Chat
                </button>
                <button class="tab-button" onclick="switchTab('magic')">
                    Magic ✨
                </button>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be dynamically added here -->
            </div>

            <div class="chat-input-area">
                <!-- Reply Context -->
                <div class="reply-context" id="replyContext" style="display: none;">
                    <div class="reply-context-content">
                        <strong id="replyTitle"></strong>
                        <div id="replyDescription" style="font-size: 0.75rem; margin-top: 0.25rem;"></div>
                    </div>
                    <button class="close-btn" onclick="clearReplyContext()">×</button>
                </div>

                <div class="input-container">
                    <input 
                        type="text" 
                        class="chat-input" 
                        id="userInput" 
                        placeholder="Type your answer..."
                        onkeypress="handleKeyPress(event)"
                    >
                    <button class="send-btn" id="sendButton" onclick="sendMessage()" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M22 2L11 13M22 2L15 22L11 13L2 9L22 2Z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Process Panel -->
        <div class="process-panel" id="processPanel">
            <div class="process-header">
                <h2 class="process-title">
                    <span style="font-size: 1.25rem;">✨</span>
                    Behind the Magic
                </h2>
                <p class="process-subtitle">Watch AI think and build in real-time</p>
            </div>

            <div class="process-content" id="processContent">
                <!-- Process items will be dynamically added here -->
            </div>
        </div>
    </div>

    <script>
        // State Management
        let currentStep = 0;
        let selectedContext = null;
        let isMobile = window.innerWidth <= 768;
        let activeTab = 'chat';
        let projectData = {
            name: '',
            type: '',
            description: '',
            colors: [],
            pages: [],
            features: []
        };

        // Wizard Steps
        const wizardSteps = [
            {
                question: "Hi! I'm excited to help you build something amazing today! 🚀\n\nWhat would you like to name your project?",
                subtitle: "Project Setup",
                quickActions: ['My Awesome App', 'Project X', 'StartupName']
            },
            {
                question: "Great name! What type of application are you building?",
                subtitle: "Choosing Template",
                quickActions: ['E-commerce', 'SaaS Platform', 'Social App', 'Blog/Content']
            },
            {
                question: "Perfect! 🎯\n\nCan you describe your vision in a few sentences? What problem does it solve?",
                subtitle: "Understanding Vision",
                quickActions: []
            }
        ];

        // Initialize
        window.onload = function() {
            setupResponsiveListeners();
            startWizard();
            updateSendButton();
        };

        // Responsive Setup
        function setupResponsiveListeners() {
            // Initial check
            checkViewport();

            // Listen for viewport changes
            window.addEventListener('resize', debounce(checkViewport, 250));
            
            // Handle orientation changes
            window.addEventListener('orientationchange', () => {
                setTimeout(checkViewport, 100);
            });
            
            // Visual viewport for mobile keyboards
            if (window.visualViewport) {
                window.visualViewport.addEventListener('resize', () => {
                    if (isMobile) {
                        scrollToBottom();
                    }
                });
            }
        }

        function checkViewport() {
            const wasDesktop = !isMobile;
            isMobile = window.innerWidth <= 768;
            
            if (wasDesktop && isMobile) {
                // Switched to mobile
                transitionToMobile();
            } else if (!wasDesktop && !isMobile) {
                // Switched to desktop
                transitionToDesktop();
            }
        }

        function transitionToMobile() {
            const processPanel = document.getElementById('processPanel');
            if (activeTab === 'magic') {
                processPanel.classList.add('active');
            } else {
                processPanel.classList.remove('active');
            }
        }

        function transitionToDesktop() {
            const processPanel = document.getElementById('processPanel');
            processPanel.classList.remove('active');
        }

        // Tab switching (mobile)
        function switchTab(tab) {
            if (!isMobile) return;
            
            activeTab = tab;
            
            // Update buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update panels
            const processPanel = document.getElementById('processPanel');
            if (tab === 'magic') {
                processPanel.classList.add('active');
            } else {
                processPanel.classList.remove('active');
                scrollToBottom();
            }
        }

        // Wizard Functions
        function startWizard() {
            addAIMessage(wizardSteps[currentStep].question);
            showQuickActions(wizardSteps[currentStep].quickActions);
            updateProgress();
            updateSubtitle(wizardSteps[currentStep].subtitle);
        }

        function addAIMessage(text, isTyping = false) {
            const chatMessages = document.getElementById('chatMessages');
            const message = document.createElement('div');
            message.className = 'message';
            
            if (isTyping) {
                message.innerHTML = `
                    <div class="message-avatar ai-avatar">AI</div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                `;
            } else {
                message.innerHTML = `
                    <div class="message-avatar ai-avatar">AI</div>
                    <div class="message-content">${text.replace(/\n/g, '<br>')}</div>
                `;
            }
            
            chatMessages.appendChild(message);
            scrollToBottom();
            
            return message;
        }

        function addUserMessage(text) {
            const chatMessages = document.getElementById('chatMessages');
            const message = document.createElement('div');
            message.className = 'message user';
            message.innerHTML = `
                <div class="message-content">${text}</div>
                <div class="message-avatar user-avatar">U</div>
            `;
            
            chatMessages.appendChild(message);
            scrollToBottom();
        }

        function showQuickActions(actions) {
            if (actions.length === 0) return;
            
            const chatMessages = document.getElementById('chatMessages');
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'quick-actions';
            actionsDiv.style.marginBottom = '1rem';
            
            actions.forEach(action => {
                const button = document.createElement('button');
                button.className = 'quick-action';
                button.textContent = action;
                button.onclick = () => {
                    document.getElementById('userInput').value = action;
                    updateSendButton();
                    sendMessage();
                };
                actionsDiv.appendChild(button);
            });
            
            chatMessages.appendChild(actionsDiv);
            scrollToBottom();
        }

        // Input Handling
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function updateSendButton() {
            const input = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = !input.value.trim();
        }

        // Add input event listener
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('userInput');
            input.addEventListener('input', updateSendButton);
        });

        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addUserMessage(message);
            input.value = '';
            updateSendButton();
            
            // Process message
            processStep(message);
        }

        function processStep(userInput) {
            // Show typing
            const typingMessage = addAIMessage('', true);
            
            // Show processing
            showProcessingSteps();
            
            setTimeout(() => {
                typingMessage.remove();
                
                currentStep++;
                
                if (currentStep < wizardSteps.length) {
                    addAIMessage(wizardSteps[currentStep].question);
                    showQuickActions(wizardSteps[currentStep].quickActions);
                    updateProgress();
                    updateSubtitle(wizardSteps[currentStep].subtitle);
                } else {
                    completeWizard();
                }
            }, 2000);
        }

        // Process Panel Functions
        function showProcessingSteps() {
            const processContent = document.getElementById('processContent');
            processContent.innerHTML = '';
            
            if (currentStep === 0) {
                // Project naming
                setTimeout(() => {
                    addProcessSection('PROJECT SETUP', [
                        { icon: '📝', text: 'Validating project name...', status: 'complete' },
                        { icon: '🔍', text: 'Checking availability...', status: 'complete' },
                        { icon: '✅', text: 'Project initialized', status: 'complete' }
                    ]);
                }, 300);
            } else if (currentStep === 1) {
                // Project type
                setTimeout(() => {
                    addProcessSection('ANALYZING PROJECT TYPE', [
                        { icon: '🏪', text: 'E-commerce platform detected', status: 'complete' },
                        { icon: '📦', text: 'Loading components...', status: 'processing' },
                        { icon: '🛒', text: 'Preparing cart system...', status: 'processing' }
                    ]);
                }, 300);
                
                setTimeout(() => {
                    const pages = [
                        { icon: '🏠', text: 'Homepage', id: 'homepage' },
                        { icon: '📱', text: 'Products', id: 'products' },
                        { icon: '🛒', text: 'Cart', id: 'cart' },
                        { icon: '💳', text: 'Checkout', id: 'checkout' },
                        { icon: '👤', text: 'Account', id: 'account' },
                        { icon: '📦', text: 'Orders', id: 'orders' }
                    ];
                    
                    addProcessSection('SUGGESTED PAGES', pages, 'page-grid');
                }, 800);
            } else if (currentStep === 2) {
                // Vision
                setTimeout(() => {
                    addProcessSection('UNDERSTANDING YOUR VISION', [
                        { icon: '🧠', text: 'Analyzing requirements...', status: 'complete' },
                        { icon: '🎯', text: 'Identifying audience...', status: 'processing' },
                        { icon: '💡', text: 'Generating features...', status: 'pending' }
                    ]);
                }, 300);
                
                setTimeout(() => {
                    addProcessSection('DESIGN SYSTEM', [
                        { icon: '🎨', text: 'Creating color palette...', status: 'processing' }
                    ]);
                    
                    // Show colors
                    const colors = [
                        { hex: '#16C181', name: 'Primary Green' },
                        { hex: '#8B5CF6', name: 'Purple Accent' },
                        { hex: '#3B82F6', name: 'Blue' },
                        { hex: '#EC4899', name: 'Pink' },
                        { hex: '#F59E0B', name: 'Orange' }
                    ];
                    
                    const colorPalette = document.createElement('div');
                    colorPalette.className = 'color-palette';
                    colorPalette.innerHTML = colors.map((color, i) => `
                        <div class="color-swatch" 
                             style="background: ${color.hex};" 
                             data-color="${color.hex}" 
                             data-name="${color.name}"
                             onclick="selectColor(this, ${i})"
                             title="${color.name}"></div>
                    `).join('');
                    document.querySelector('.process-section:last-child').appendChild(colorPalette);
                }, 1000);
                
                setTimeout(() => {
                    const features = [
                        { icon: '🔐', text: 'User Authentication', id: 'auth' },
                        { icon: '🔍', text: 'Search & Filters', id: 'search' },
                        { icon: '💳', text: 'Payment Processing', id: 'payment' },
                        { icon: '📊', text: 'Analytics', id: 'analytics' },
                        { icon: '📧', text: 'Email System', id: 'email' }
                    ];
                    
                    addProcessSection('CORE FEATURES', features, 'feature-list');
                }, 1500);
            }
        }

        function addProcessSection(title, items, layout = 'default') {
            const processContent = document.getElementById('processContent');
            const section = document.createElement('div');
            section.className = 'process-section';
            
            section.innerHTML = `
                <h3 class="process-section-title">
                    <div class="loader">
                        <div class="loader-dot"></div>
                        <div class="loader-dot"></div>
                        <div class="loader-dot"></div>
                    </div>
                    ${title}
                </h3>
            `;
            
            if (layout === 'page-grid') {
                const grid = document.createElement('div');
                grid.className = 'page-grid';
                items.forEach((item, index) => {
                    setTimeout(() => {
                        const pageItem = document.createElement('div');
                        pageItem.className = 'page-item selected';
                        pageItem.style.animationDelay = `${index * 0.1}s`;
                        pageItem.innerHTML = `
                            <div class="page-icon">${item.icon}</div>
                            <div class="page-name">${item.text}</div>
                        `;
                        
                        pageItem.onclick = function() {
                            this.classList.toggle('selected');
                            
                            if (this.classList.contains('selected')) {
                                if (!projectData.pages.includes(item.id)) {
                                    projectData.pages.push(item.id);
                                }
                            } else {
                                projectData.pages = projectData.pages.filter(p => p !== item.id);
                            }
                            
                            // On mobile, switch to chat for interaction
                            if (isMobile && !this.classList.contains('selected')) {
                                selectItem('page', item);
                            }
                        };
                        
                        grid.appendChild(pageItem);
                        
                        if (!projectData.pages.includes(item.id)) {
                            projectData.pages.push(item.id);
                        }
                    }, index * 100);
                });
                section.appendChild(grid);
            } else if (layout === 'feature-list') {
                const list = document.createElement('div');
                list.className = 'feature-list';
                items.forEach((item, index) => {
                    setTimeout(() => {
                        const featureItem = document.createElement('div');
                        featureItem.className = 'feature-item';
                        featureItem.style.animationDelay = `${index * 0.1}s`;
                        featureItem.innerHTML = `
                            <div class="feature-check">✓</div>
                            <span>${item.text}</span>
                        `;
                        featureItem.onclick = () => selectItem('feature', item);
                        list.appendChild(featureItem);
                    }, index * 100);
                });
                section.appendChild(list);
            } else {
                items.forEach((item, index) => {
                    setTimeout(() => {
                        const processItem = document.createElement('div');
                        processItem.className = `process-item ${item.status === 'processing' ? 'active' : ''}`;
                        processItem.style.animationDelay = `${index * 0.1}s`;
                        processItem.innerHTML = `
                            <div class="process-icon" style="background: ${getIconBackground(item.status)};">
                                ${item.icon}
                            </div>
                            <div class="process-text">${item.text}</div>
                            <div class="process-status status-${item.status}">
                                ${item.status === 'complete' ? '✓' : item.status === 'processing' ? '' : ''}
                            </div>
                        `;
                        processItem.onclick = () => selectItem('process', item);
                        section.appendChild(processItem);
                    }, index * 150);
                });
            }
            
            processContent.appendChild(section);
        }

        function getIconBackground(status) {
            switch(status) {
                case 'complete': return 'rgba(22, 193, 129, 0.2)';
                case 'processing': return 'rgba(234, 179, 8, 0.2)';
                default: return 'var(--bg-tertiary)';
            }
        }

        // Selection Functions
        function selectColor(element, index) {
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected'));
            element.classList.add('selected');
            
            const color = element.dataset.color;
            const name = element.dataset.name;
            
            selectItem('color', { hex: color, name: name });
        }

        function selectItem(type, item) {
            // Clear previous selections (except pages)
            if (type !== 'page') {
                document.querySelectorAll('.selected').forEach(el => {
                    if (!el.classList.contains('page-item')) {
                        el.classList.remove('selected');
                    }
                });
            }
            
            // Mark item as selected
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('selected');
            }
            
            // Set reply context
            let title, description, message;
            
            switch(type) {
                case 'color':
                    title = `Color: ${item.name}`;
                    description = `Selected ${item.hex}`;
                    message = `I see you're interested in ${item.name}. Would you like this as your primary brand color?`;
                    break;
                case 'page':
                    title = `Page: ${item.text}`;
                    description = `Customizing ${item.text} page`;
                    message = `Tell me more about what you'd like on the ${item.text} page. Any specific features or layout preferences?`;
                    break;
                case 'feature':
                    title = `Feature: ${item.text}`;
                    description = `Discussing ${item.text}`;
                    message = `How do you envision the "${item.text}" working in your app? Any specific requirements?`;
                    break;
                default:
                    title = item.text;
                    description = `About ${item.text}`;
                    message = `Would you like to know more about this?`;
            }
            
            setReplyContext(title, description);
            
            // Switch to chat tab on mobile
            if (isMobile) {
                document.querySelector('.tab-button').click();
            }
            
            // Add AI message
            setTimeout(() => {
                addAIMessage(message);
                document.getElementById('userInput').focus();
            }, 300);
        }

        function setReplyContext(title, description) {
            selectedContext = { title, description };
            
            const replyContext = document.getElementById('replyContext');
            document.getElementById('replyTitle').textContent = title;
            document.getElementById('replyDescription').textContent = description;
            replyContext.style.display = 'flex';
        }

        function clearReplyContext() {
            selectedContext = null;
            document.getElementById('replyContext').style.display = 'none';
            
            // Clear non-page selections
            document.querySelectorAll('.selected').forEach(el => {
                if (!el.classList.contains('page-item')) {
                    el.classList.remove('selected');
                }
            });
        }

        // Utility Functions
        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }

        function updateProgress() {
            const progress = ((currentStep + 1) / wizardSteps.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function updateSubtitle(subtitle) {
            document.getElementById('wizardSubtitle').textContent = subtitle;
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function completeWizard() {
            addAIMessage("🎉 Amazing! I've got everything I need. Your app blueprint is ready!\n\nClick 'Start Building' below to see your vision come to life!");
            updateSubtitle('Ready to Build!');
            
            // Add completion process items
            setTimeout(() => {
                const processContent = document.getElementById('processContent');
                processContent.innerHTML = '';
                addProcessSection('✅ READY TO BUILD', [
                    { icon: '📐', text: 'Architecture planned', status: 'complete' },
                    { icon: '🎨', text: 'Design system ready', status: 'complete' },
                    { icon: '📱', text: 'Mobile optimized', status: 'complete' },
                    { icon: '🚀', text: 'Ready to launch!', status: 'complete' }
                ]);
            }, 500);
            
            // Add start button
            setTimeout(() => {
                const chatMessages = document.getElementById('chatMessages');
                const button = document.createElement('button');
                button.style.cssText = `
                    background: var(--primary-500);
                    color: white;
                    border: none;
                    border-radius: 24px;
                    padding: 1rem 2rem;
                    font-size: 1rem;
                    font-weight: 600;
                    margin: 1rem auto;
                    display: block;
                    cursor: pointer;
                    transition: all 0.2s;
                `;
                button.textContent = 'Start Building →';
                button.onmouseover = () => button.style.transform = 'scale(1.05)';
                button.onmouseout = () => button.style.transform = 'scale(1)';
                button.onclick = () => alert('Navigate to builder!');
                chatMessages.appendChild(button);
                scrollToBottom();
            }, 1000);
        }
    </script>
</body>
</html>